<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Expiring_soon_email</name>
        <label>Expiring soon email</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>NotificationContacts</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>CurrentUser</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>composeEmailContent</name>
            <value>
                <stringValue>True</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>Bank Feed account authorization ending</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <stringValue>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); font-size: 14px; font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; color: rgb(41, 42, 46);&quot;&gt;Dear Bank Feed Customer,&lt;/span&gt;&lt;/p&gt;&lt;p&gt;The authorization for bank account(s) {!FormattedExpiringSoonBankAccountNames}  is expiring soon. If you want to continue to use this bank account, please &lt;a href=&quot;https://docs.findock.com/reconciliation/findock-bank-feed#reauthorizing-a-connected-account&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; style=&quot;color: rgb(24, 104, 219);&quot;&gt;reauthorize the connection&lt;/a&gt; to ensure FinDock can continue to import transactions with interruption.&lt;/p&gt;&lt;p&gt;Regards,&lt;/p&gt;&lt;p&gt;The FinDock Team&lt;/p&gt;</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>useLineBreaks</name>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
        <versionString>1.0.1</versionString>
    </actionCalls>
    <actionCalls>
        <name>Send_expired_email</name>
        <label>Expired email</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Expiration_Status</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>NotificationContacts</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>CurrentUser</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>composeEmailContent</name>
            <value>
                <stringValue>True</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>Bank Feed account authorization expired</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <stringValue>&lt;p&gt;&lt;span style=&quot;color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px; background-color: rgb(255, 255, 255);&quot;&gt;Dear Bank Feed Customer,&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px; background-color: rgb(255, 255, 255);&quot;&gt;The authorization for bank account(s) &lt;/span&gt;{!FormattedExpiredBankAccountNames} &lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px;&quot;&gt;has expired. FinDock cannot import transaction from the account until the connection is reauthorized. If you want to continue to use this bank account, please &lt;/span&gt;&lt;a href=&quot;https://docs.findock.com/reconciliation/findock-bank-feed#reauthorizing-a-connected-account&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; style=&quot;background-color: rgb(255, 255, 255); color: rgb(24, 104, 219); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px;&quot;&gt;reauthorize the connection&lt;/a&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px; background-color: rgb(255, 255, 255);&quot;&gt;Regards,&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(41, 42, 46); font-family: &amp;quot;Atlassian Sans&amp;quot;, ui-sans-serif, -apple-system, &amp;quot;system-ui&amp;quot;, &amp;quot;Segoe UI&amp;quot;, Ubuntu, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; font-size: 14px; background-color: rgb(255, 255, 255);&quot;&gt;The FinDock Team&lt;/span&gt;&lt;/p&gt;</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>useLineBreaks</name>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
        <versionString>1.0.1</versionString>
    </actionCalls>
    <apiVersion>64.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>Add Authorization to Current Authorizations Set</description>
        <name>add_to_Current_Authorizations</name>
        <label>add to Current Authorizations</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>CurrentAuthorizationIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>on_All_Bank_Account_Authorizations.cpm__Bank_Feed_Authorization__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CurrentBankAccountIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>on_All_Bank_Account_Authorizations.cpm__Bank_Feed_Account__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>on_All_Bank_Account_Authorizations</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>formatted email addresses</description>
        <name>Format_Email_addresses</name>
        <label>Format Email addresses</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>NotificationContacts</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>FormattedEmailAddresses</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>on_Authorizations</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_email_adresses</name>
        <label>Set email adresses</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>NotificationContacts</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>{!NotificationContacts}{!foreach_NotificationContacts.cpm__Email__c}, </stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>foreach_NotificationContacts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>set_Expired_Bank_Account_Names</name>
        <label>set Expired Bank Account Names</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ExpiredBankAccountNames</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>{!ExpiredBankAccountNames}{!on_Related_Bank_Accounts.cpm__IBAN__c},</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>on_Related_Bank_Accounts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>set_Expiring_Soon_Bank_Account_Names</name>
        <label>set Expiring Soon Bank Account Names</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>ExpiringSoonBankAccountNames</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>{!ExpiringSoonBankAccountNames}{!on_Related_Bank_Accounts.cpm__IBAN__c},</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>on_Related_Bank_Accounts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Id_list</name>
        <label>Set Authorization Ids</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>AuthorizationIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>on_Bank_Feed_Authorizations.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>on_Bank_Feed_Authorizations</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <description>Filter bank accounts per authorization</description>
        <name>Filter_by_Authorization</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Bank Authorization Accounts by Authorization</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNextValueToReference>currentItem_Filter_by_Authorization</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Bank_Authorization_Accounts</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_by_Authorization.cpm__Bank_Feed_Authorization__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>on_Authorizations.Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>on_Related_Bank_Authorization_Accounts</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>Related_Bank_Accounts</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Related Bank Accounts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNextValueToReference>currentItem_Related_Bank_Accounts</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Bank_Accounts</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Related_Bank_Accounts.Id</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>on_Related_Bank_Authorization_Accounts.cpm__Bank_Feed_Account__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>on_Related_Bank_Accounts</targetReference>
        </connector>
    </collectionProcessors>
    <decisions>
        <description>Is expiring soon bank accounts exists?</description>
        <name>Expiration_Status</name>
        <label>is Expiring Soon Bank Accounts Exists</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Expiring_Soon_Exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ExpiringSoonBankAccountNames</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Expiring_soon_email</targetReference>
            </connector>
            <label>Expiring Soon Exists</label>
        </rules>
    </decisions>
    <decisions>
        <name>is_Current_Authorization</name>
        <label>is Current Authorization or first item?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>on_All_Bank_Account_Authorizations</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Continue</defaultConnectorLabel>
        <rules>
            <name>Individual_bank_acount</name>
            <conditionLogic>(NOT 1) OR 2</conditionLogic>
            <conditions>
                <leftValueReference>CurrentBankAccountIds</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>on_All_Bank_Account_Authorizations.cpm__Bank_Feed_Account__r.Id</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>CurrentBankAccountIds</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>add_to_Current_Authorizations</targetReference>
            </connector>
            <label>Individual bank acount</label>
        </rules>
    </decisions>
    <decisions>
        <name>is_Current_Authorization2</name>
        <label>is Current Authorization</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>on_Authorizations</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Old authorization</defaultConnectorLabel>
        <rules>
            <name>Outcome_1_of_Decision_5</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CurrentAuthorizationIds</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>on_Authorizations.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Filter_by_Authorization</targetReference>
            </connector>
            <label>Current Authorization</label>
        </rules>
    </decisions>
    <decisions>
        <name>is_Expired_Bank_Accounts_Exist</name>
        <label>is Expired Bank Accounts Exist</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Expiration_Status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes_expired_bank_accounts_exists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ExpiredBankAccountNames</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_expired_email</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Check if this bank account has already expired or expiring soon?</description>
        <name>Is_Expired_or_Expiring</name>
        <label>Is Expired or Expiring?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>on_Related_Bank_Accounts</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Expired_Bank_account</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>on_Authorizations.cpm__Expiry_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>NOW</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>on_Authorizations.cpm__Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Expired</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>set_Expired_Bank_Account_Names</targetReference>
            </connector>
            <label>Expired</label>
        </rules>
        <rules>
            <name>Expiring_Soon_bank_account</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>on_Authorizations.cpm__Expiry_Date__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>Next_Two_Weeks</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>on_Authorizations.cpm__Expiry_Date__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>NOW</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>on_Authorizations.cpm__Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Connected</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>set_Expiring_Soon_Bank_Account_Names</targetReference>
            </connector>
            <label>Expiring Soon</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_there_any</name>
        <label>Is there any Authorizations?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Bank_Feed_Authorization</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>on_Bank_Feed_Authorizations</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_there_any_bank_auth_accounts</name>
        <label>Is there any related Bank Authorization Accounts?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_bank_accounts</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Bank_Authorization_Accounts</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Bank_Accounts</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>FormattedEmailAddresses</name>
        <dataType>String</dataType>
        <expression>LEFT({!NotificationContacts}, LEN({!NotificationContacts}) - 2)</expression>
    </formulas>
    <formulas>
        <description>make it concanated with comma</description>
        <name>FormattedExpiredBankAccountNames</name>
        <dataType>String</dataType>
        <expression>LEFT({!ExpiredBankAccountNames}, LEN({!ExpiredBankAccountNames}) - 2)</expression>
    </formulas>
    <formulas>
        <name>FormattedExpiringSoonBankAccountNames</name>
        <dataType>String</dataType>
        <expression>LEFT({!ExpiringSoonBankAccountNames}, LEN({!ExpiringSoonBankAccountNames}) - 2)</expression>
    </formulas>
    <formulas>
        <description>NOW() + 14days</description>
        <name>Next_Two_Weeks</name>
        <dataType>DateTime</dataType>
        <expression>NOW() + 14</expression>
    </formulas>
    <formulas>
        <description>NOW()</description>
        <name>NOW</name>
        <dataType>DateTime</dataType>
        <expression>NOW()</expression>
    </formulas>
    <interviewLabel>Bank Feed Accounts Expiration Date Remainder {!$Flow.CurrentDateTime}</interviewLabel>
    <isTemplate>true</isTemplate>
    <label>Bank Feed Accounts Expiration Date Remainder</label>
    <loops>
        <name>foreach_NotificationContacts</name>
        <label>on NotificationContacts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Get_Notification_Contacts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_email_adresses</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Format_Email_addresses</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>loop on all Bank Account Authorizations</description>
        <name>on_All_Bank_Account_Authorizations</name>
        <label>on All Bank Account Authorizations</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Get_Bank_Authorization_Accounts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>is_Current_Authorization</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Is_there_any_bank_auth_accounts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Loop on Authroziation to get related bank accounts</description>
        <name>on_Authorizations</name>
        <label>on Authorizations</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Get_Bank_Feed_Authorization</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>is_Current_Authorization2</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>is_Expired_Bank_Accounts_Exist</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>foreach BankFeedAuthorization</description>
        <name>on_Bank_Feed_Authorizations</name>
        <label>on Bank Feed Authorizations</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Get_Bank_Feed_Authorization</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Id_list</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Bank_Authorization_Accounts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>on_Related_Bank_Accounts</name>
        <label>on Related Bank Accounts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Related_Bank_Accounts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_Expired_or_Expiring</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>on_Related_Bank_Authorization_Accounts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>on_Related_Bank_Authorization_Accounts</name>
        <label>on Related Bank Authorization Accounts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Filter_by_Authorization</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Related_Bank_Accounts</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>on_Authorizations</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get related bank accounts</description>
        <name>Get_Bank_Accounts</name>
        <label>Get Bank Accounts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Notification_Contacts</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>In</operator>
            <value>
                <elementReference>CurrentBankAccountIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>cpm__Bank_Account__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>cpm__IBAN__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get Bank Feed Authorization Account</description>
        <name>Get_Bank_Authorization_Accounts</name>
        <label>Get Bank Authorization Accounts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>on_All_Bank_Account_Authorizations</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>cpm__Bank_Feed_Authorization__c</field>
            <operator>In</operator>
            <value>
                <elementReference>AuthorizationIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>cpm__Bank_Feed_Authorization_Account__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get bank feed authorizations</description>
        <name>Get_Bank_Feed_Authorization</name>
        <label>Get Bank Feed Authorization</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_there_any</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>cpm__Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Connected</stringValue>
            </value>
        </filters>
        <filters>
            <field>cpm__Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Expired</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>cpm__Bank_Feed_Authorization__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>cpm__Expiry_Date__c</queriedFields>
        <queriedFields>cpm__Status__c</queriedFields>
        <sortField>cpm__Expiry_Date__c</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get email addresses of notification contacts (product)</description>
        <name>Get_Notification_Contacts</name>
        <label>Get Notification Contacts</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>foreach_NotificationContacts</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>cpm__Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Product</stringValue>
            </value>
        </filters>
        <filters>
            <field>cpm__isActive__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>cpm__Notification_Contacts__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>cpm__Email__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Bank_Feed_Authorization</targetReference>
        </connector>
        <schedule>
            <frequency>Weekly</frequency>
            <startDate>2025-08-04</startDate>
            <startTime>06:00:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Draft</status>
    <variables>
        <name>AuthorizationIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>BankAccountIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Count_Authorizations</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>CurrentAuthorizationIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Current Bank Account Id Set</description>
        <name>CurrentBankAccountIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentItem_Collection_Filter_3</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_Bank_Accounts_by_BankAccountAuthorizations</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization_Account__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_by_Authorization</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization_Account__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Find_Current_Authorizations</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization__c</objectType>
    </variables>
    <variables>
        <name>currentItem_get_Current_Authorizations</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Related_Bank_Accounts</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Account__c</objectType>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Feed_Authorization_Account__c</objectType>
    </variables>
    <variables>
        <description>Related bank acocunt names concanated with comma</description>
        <name>ExpiredBankAccountNames</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>ExpiringSoonBankAccountNames</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>NotificationContacts</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>Relatedbankaccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>cpm__Bank_Account__c</objectType>
    </variables>
</Flow>
